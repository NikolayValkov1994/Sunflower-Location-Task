{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useState } from \"react\";\nconst OPTIONS = {\n  enableHighAccuracy: true,\n  maximumAge: 0\n};\nconst useMyLocation = () => {\n  _s();\n  const [locationInfo, setLocationInfo] = useState({\n    lon: 0,\n    lat: 0,\n    accuracy: 0\n  });\n  const [error, setError] = useState({\n    message: \"\"\n  });\n  const [loading, setLoading] = useState(false);\n  const onSuccess = position => {\n    try {\n      const freshLon = position.coords.longitude;\n      const freshLat = position.coords.latitude;\n      const accuracy = position.coords.accuracy;\n\n      //If the coordinates are changed update them\n      if (freshLon !== (locationInfo === null || locationInfo === void 0 ? void 0 : locationInfo.lon) || freshLat !== (locationInfo === null || locationInfo === void 0 ? void 0 : locationInfo.lat)) {\n        setLocationInfo({\n          lon: freshLon,\n          lat: freshLat,\n          accuracy\n        });\n      }\n    } catch (e) {\n      setError(e);\n    }\n    setLoading(false);\n  };\n  const onError = error => {\n    setError(error);\n    setLoading(false);\n  };\n  const getMyLocationHandler = async () => {\n    try {\n      if (navigator.geolocation) {\n        setLoading(true);\n        const permissions = await navigator.permissions.query({\n          name: \"geolocation\"\n        });\n        if (permissions.state === \"granted\" || permissions.state === \"prompt\") {\n          const watcherId = navigator.geolocation.watchPosition(onSuccess, onError, OPTIONS);\n          console.log(\"waiiittt\");\n          return () => {\n            console.log(\"OUTTTTT\");\n          };\n        } else {\n          throw new Error(`Location permission state is ${permissions.state}. Please give permissions to access your location.`);\n        }\n      } else {\n        throw new Error(\"Geolocation is not supported by this browser.\");\n      }\n    } catch (e) {\n      setError(e);\n      setLoading(false);\n    }\n  };\n  useEffect(() => {\n    getMyLocationHandler();\n  }, []);\n  return {\n    locationInfo,\n    error,\n    loading\n  };\n};\n_s(useMyLocation, \"v4rG25MNz1AO0NV3+ZSOlN/T26w=\");\nexport default useMyLocation;","map":{"version":3,"names":["useEffect","useState","OPTIONS","enableHighAccuracy","maximumAge","useMyLocation","_s","locationInfo","setLocationInfo","lon","lat","accuracy","error","setError","message","loading","setLoading","onSuccess","position","freshLon","coords","longitude","freshLat","latitude","e","onError","getMyLocationHandler","navigator","geolocation","permissions","query","name","state","watcherId","watchPosition","console","log","Error"],"sources":["/Users/nikolayvalkov/work/my-location/src/hooks/useMyLocation.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\n\nconst OPTIONS = { enableHighAccuracy: true, maximumAge: 0 };\n\nconst useMyLocation = () => {\n\tconst [locationInfo, setLocationInfo] = useState({\n\t\tlon: 0,\n\t\tlat: 0,\n\t\taccuracy: 0,\n\t});\n\tconst [error, setError] = useState({ message: \"\" });\n\tconst [loading, setLoading] = useState(false);\n\n\tconst onSuccess = (position) => {\n\t\ttry {\n\t\t\tconst freshLon = position.coords.longitude;\n\t\t\tconst freshLat = position.coords.latitude;\n\t\t\tconst accuracy = position.coords.accuracy;\n\n\t\t\t//If the coordinates are changed update them\n\t\t\tif (\n\t\t\t\tfreshLon !== locationInfo?.lon ||\n\t\t\t\tfreshLat !== locationInfo?.lat\n\t\t\t) {\n\t\t\t\tsetLocationInfo({ lon: freshLon, lat: freshLat, accuracy });\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tsetError(e);\n\t\t}\n\t\tsetLoading(false);\n\t};\n\n\tconst onError = (error) => {\n\t\tsetError(error);\n\t\tsetLoading(false);\n\t};\n\n\tconst getMyLocationHandler = async () => {\n\t\ttry {\n\t\t\tif (navigator.geolocation) {\n\t\t\t\tsetLoading(true);\n\t\t\t\tconst permissions = await navigator.permissions.query({\n\t\t\t\t\tname: \"geolocation\",\n\t\t\t\t});\n\n\t\t\t\tif (\n\t\t\t\t\tpermissions.state === \"granted\" ||\n\t\t\t\t\tpermissions.state === \"prompt\"\n\t\t\t\t) {\n\t\t\t\t\tconst watcherId = navigator.geolocation.watchPosition(\n\t\t\t\t\t\tonSuccess,\n\t\t\t\t\t\tonError,\n\t\t\t\t\t\tOPTIONS\n\t\t\t\t\t);\n\t\t\t\t\tconsole.log(\"waiiittt\");\n\t\t\t\t\treturn () => {\n\t\t\t\t\t\tconsole.log(\"OUTTTTT\");\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t`Location permission state is ${permissions.state}. Please give permissions to access your location.`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t\"Geolocation is not supported by this browser.\"\n\t\t\t\t);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tsetError(e);\n\t\t\tsetLoading(false);\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tgetMyLocationHandler();\n\t}, []);\n\n\treturn {\n\t\tlocationInfo,\n\t\terror,\n\t\tloading,\n\t};\n};\n\nexport default useMyLocation;\n"],"mappings":";AAAA,SAASA,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAE3C,MAAMC,OAAO,GAAG;EAAEC,kBAAkB,EAAE,IAAI;EAAEC,UAAU,EAAE;AAAE,CAAC;AAE3D,MAAMC,aAAa,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAC3B,MAAM,CAACC,YAAY,EAAEC,eAAe,CAAC,GAAGP,QAAQ,CAAC;IAChDQ,GAAG,EAAE,CAAC;IACNC,GAAG,EAAE,CAAC;IACNC,QAAQ,EAAE;EACX,CAAC,CAAC;EACF,MAAM,CAACC,KAAK,EAAEC,QAAQ,CAAC,GAAGZ,QAAQ,CAAC;IAAEa,OAAO,EAAE;EAAG,CAAC,CAAC;EACnD,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAGf,QAAQ,CAAC,KAAK,CAAC;EAE7C,MAAMgB,SAAS,GAAIC,QAAQ,IAAK;IAC/B,IAAI;MACH,MAAMC,QAAQ,GAAGD,QAAQ,CAACE,MAAM,CAACC,SAAS;MAC1C,MAAMC,QAAQ,GAAGJ,QAAQ,CAACE,MAAM,CAACG,QAAQ;MACzC,MAAMZ,QAAQ,GAAGO,QAAQ,CAACE,MAAM,CAACT,QAAQ;;MAEzC;MACA,IACCQ,QAAQ,MAAKZ,YAAY,aAAZA,YAAY,uBAAZA,YAAY,CAAEE,GAAG,KAC9Ba,QAAQ,MAAKf,YAAY,aAAZA,YAAY,uBAAZA,YAAY,CAAEG,GAAG,GAC7B;QACDF,eAAe,CAAC;UAAEC,GAAG,EAAEU,QAAQ;UAAET,GAAG,EAAEY,QAAQ;UAAEX;QAAS,CAAC,CAAC;MAC5D;IACD,CAAC,CAAC,OAAOa,CAAC,EAAE;MACXX,QAAQ,CAACW,CAAC,CAAC;IACZ;IACAR,UAAU,CAAC,KAAK,CAAC;EAClB,CAAC;EAED,MAAMS,OAAO,GAAIb,KAAK,IAAK;IAC1BC,QAAQ,CAACD,KAAK,CAAC;IACfI,UAAU,CAAC,KAAK,CAAC;EAClB,CAAC;EAED,MAAMU,oBAAoB,GAAG,MAAAA,CAAA,KAAY;IACxC,IAAI;MACH,IAAIC,SAAS,CAACC,WAAW,EAAE;QAC1BZ,UAAU,CAAC,IAAI,CAAC;QAChB,MAAMa,WAAW,GAAG,MAAMF,SAAS,CAACE,WAAW,CAACC,KAAK,CAAC;UACrDC,IAAI,EAAE;QACP,CAAC,CAAC;QAEF,IACCF,WAAW,CAACG,KAAK,KAAK,SAAS,IAC/BH,WAAW,CAACG,KAAK,KAAK,QAAQ,EAC7B;UACD,MAAMC,SAAS,GAAGN,SAAS,CAACC,WAAW,CAACM,aAAa,CACpDjB,SAAS,EACTQ,OAAO,EACPvB,OACD,CAAC;UACDiC,OAAO,CAACC,GAAG,CAAC,UAAU,CAAC;UACvB,OAAO,MAAM;YACZD,OAAO,CAACC,GAAG,CAAC,SAAS,CAAC;UACvB,CAAC;QACF,CAAC,MAAM;UACN,MAAM,IAAIC,KAAK,CACb,gCAA+BR,WAAW,CAACG,KAAM,oDACnD,CAAC;QACF;MACD,CAAC,MAAM;QACN,MAAM,IAAIK,KAAK,CACd,+CACD,CAAC;MACF;IACD,CAAC,CAAC,OAAOb,CAAC,EAAE;MACXX,QAAQ,CAACW,CAAC,CAAC;MACXR,UAAU,CAAC,KAAK,CAAC;IAClB;EACD,CAAC;EAEDhB,SAAS,CAAC,MAAM;IACf0B,oBAAoB,CAAC,CAAC;EACvB,CAAC,EAAE,EAAE,CAAC;EAEN,OAAO;IACNnB,YAAY;IACZK,KAAK;IACLG;EACD,CAAC;AACF,CAAC;AAACT,EAAA,CA/EID,aAAa;AAiFnB,eAAeA,aAAa"},"metadata":{},"sourceType":"module","externalDependencies":[]}