{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useState } from \"react\";\nconst OPTIONS = {\n  enableHighAccuracy: true,\n  maximumAge: 0\n};\nconst useMyLocation = () => {\n  _s();\n  let watcherId;\n  const [locationInfo, setLocationInfo] = useState({\n    lon: 0,\n    lat: 0,\n    accuracy: 0\n  });\n  const [error, setError] = useState({\n    message: \"\"\n  });\n  const [loading, setLoading] = useState(false);\n  const onSuccess = position => {\n    try {\n      const freshLon = position.coords.longitude;\n      const freshLat = position.coords.latitude;\n      const accuracy = position.coords.accuracy;\n\n      //If the coordinates are changed update them\n      if (freshLon !== (locationInfo === null || locationInfo === void 0 ? void 0 : locationInfo.lon) || freshLat !== (locationInfo === null || locationInfo === void 0 ? void 0 : locationInfo.lat)) {\n        setLocationInfo({\n          lon: freshLon,\n          lat: freshLat,\n          accuracy\n        });\n      }\n    } catch (e) {\n      setError(e);\n    }\n  };\n  const onError = error => {\n    setError(error);\n  };\n  const getMyLocationHandler = async () => {\n    try {\n      if (navigator.geolocation) {\n        const permissions = await navigator.permissions.query({\n          name: \"geolocation\"\n        });\n        console.log(permissions);\n        if (permissions.state === \"granted\") {\n          watcherId = navigator.geolocation.watchPosition(onSuccess, onError, OPTIONS);\n        }\n      } else {\n        throw new Error(\"Geolocation is not supported by this browser.\");\n      }\n    } catch (e) {\n      setError(e);\n    }\n  };\n  useEffect(() => {\n    getMyLocationHandler();\n    return () => navigator.geolocation.clearWatch(watcherId);\n  }, []);\n  return {\n    locationInfo,\n    error,\n    loading\n  };\n};\n_s(useMyLocation, \"v4rG25MNz1AO0NV3+ZSOlN/T26w=\");\nexport default useMyLocation;","map":{"version":3,"names":["useEffect","useState","OPTIONS","enableHighAccuracy","maximumAge","useMyLocation","_s","watcherId","locationInfo","setLocationInfo","lon","lat","accuracy","error","setError","message","loading","setLoading","onSuccess","position","freshLon","coords","longitude","freshLat","latitude","e","onError","getMyLocationHandler","navigator","geolocation","permissions","query","name","console","log","state","watchPosition","Error","clearWatch"],"sources":["/Users/nikolayvalkov/work/my-location/src/hooks/useMyLocation.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\n\nconst OPTIONS = { enableHighAccuracy: true, maximumAge: 0 };\n\nconst useMyLocation = () => {\n\tlet watcherId;\n\tconst [locationInfo, setLocationInfo] = useState({\n\t\tlon: 0,\n\t\tlat: 0,\n\t\taccuracy: 0,\n\t});\n\tconst [error, setError] = useState({ message: \"\" });\n\tconst [loading, setLoading] = useState(false);\n\n\tconst onSuccess = (position) => {\n\t\ttry {\n\t\t\tconst freshLon = position.coords.longitude;\n\t\t\tconst freshLat = position.coords.latitude;\n\t\t\tconst accuracy = position.coords.accuracy;\n\n\t\t\t//If the coordinates are changed update them\n\t\t\tif (\n\t\t\t\tfreshLon !== locationInfo?.lon ||\n\t\t\t\tfreshLat !== locationInfo?.lat\n\t\t\t) {\n\t\t\t\tsetLocationInfo({ lon: freshLon, lat: freshLat, accuracy });\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tsetError(e);\n\t\t}\n\t};\n\n\tconst onError = (error) => {\n\t\tsetError(error);\n\t};\n\n\tconst getMyLocationHandler = async () => {\n\t\ttry {\n\t\t\tif (navigator.geolocation) {\n\t\t\t\tconst permissions = await navigator.permissions.query({\n\t\t\t\t\tname: \"geolocation\",\n\t\t\t\t});\n\n\t\t\t\tconsole.log(permissions);\n\n\t\t\t\tif (permissions.state === \"granted\") {\n\t\t\t\t\twatcherId = navigator.geolocation.watchPosition(\n\t\t\t\t\t\tonSuccess,\n\t\t\t\t\t\tonError,\n\t\t\t\t\t\tOPTIONS\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t\"Geolocation is not supported by this browser.\"\n\t\t\t\t);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tsetError(e);\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tgetMyLocationHandler();\n\n\t\treturn () => navigator.geolocation.clearWatch(watcherId);\n\t}, []);\n\n\treturn {\n\t\tlocationInfo,\n\t\terror,\n\t\tloading,\n\t};\n};\n\nexport default useMyLocation;\n"],"mappings":";AAAA,SAASA,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAE3C,MAAMC,OAAO,GAAG;EAAEC,kBAAkB,EAAE,IAAI;EAAEC,UAAU,EAAE;AAAE,CAAC;AAE3D,MAAMC,aAAa,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAC3B,IAAIC,SAAS;EACb,MAAM,CAACC,YAAY,EAAEC,eAAe,CAAC,GAAGR,QAAQ,CAAC;IAChDS,GAAG,EAAE,CAAC;IACNC,GAAG,EAAE,CAAC;IACNC,QAAQ,EAAE;EACX,CAAC,CAAC;EACF,MAAM,CAACC,KAAK,EAAEC,QAAQ,CAAC,GAAGb,QAAQ,CAAC;IAAEc,OAAO,EAAE;EAAG,CAAC,CAAC;EACnD,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAGhB,QAAQ,CAAC,KAAK,CAAC;EAE7C,MAAMiB,SAAS,GAAIC,QAAQ,IAAK;IAC/B,IAAI;MACH,MAAMC,QAAQ,GAAGD,QAAQ,CAACE,MAAM,CAACC,SAAS;MAC1C,MAAMC,QAAQ,GAAGJ,QAAQ,CAACE,MAAM,CAACG,QAAQ;MACzC,MAAMZ,QAAQ,GAAGO,QAAQ,CAACE,MAAM,CAACT,QAAQ;;MAEzC;MACA,IACCQ,QAAQ,MAAKZ,YAAY,aAAZA,YAAY,uBAAZA,YAAY,CAAEE,GAAG,KAC9Ba,QAAQ,MAAKf,YAAY,aAAZA,YAAY,uBAAZA,YAAY,CAAEG,GAAG,GAC7B;QACDF,eAAe,CAAC;UAAEC,GAAG,EAAEU,QAAQ;UAAET,GAAG,EAAEY,QAAQ;UAAEX;QAAS,CAAC,CAAC;MAC5D;IACD,CAAC,CAAC,OAAOa,CAAC,EAAE;MACXX,QAAQ,CAACW,CAAC,CAAC;IACZ;EACD,CAAC;EAED,MAAMC,OAAO,GAAIb,KAAK,IAAK;IAC1BC,QAAQ,CAACD,KAAK,CAAC;EAChB,CAAC;EAED,MAAMc,oBAAoB,GAAG,MAAAA,CAAA,KAAY;IACxC,IAAI;MACH,IAAIC,SAAS,CAACC,WAAW,EAAE;QAC1B,MAAMC,WAAW,GAAG,MAAMF,SAAS,CAACE,WAAW,CAACC,KAAK,CAAC;UACrDC,IAAI,EAAE;QACP,CAAC,CAAC;QAEFC,OAAO,CAACC,GAAG,CAACJ,WAAW,CAAC;QAExB,IAAIA,WAAW,CAACK,KAAK,KAAK,SAAS,EAAE;UACpC5B,SAAS,GAAGqB,SAAS,CAACC,WAAW,CAACO,aAAa,CAC9ClB,SAAS,EACTQ,OAAO,EACPxB,OACD,CAAC;QACF;MACD,CAAC,MAAM;QACN,MAAM,IAAImC,KAAK,CACd,+CACD,CAAC;MACF;IACD,CAAC,CAAC,OAAOZ,CAAC,EAAE;MACXX,QAAQ,CAACW,CAAC,CAAC;IACZ;EACD,CAAC;EAEDzB,SAAS,CAAC,MAAM;IACf2B,oBAAoB,CAAC,CAAC;IAEtB,OAAO,MAAMC,SAAS,CAACC,WAAW,CAACS,UAAU,CAAC/B,SAAS,CAAC;EACzD,CAAC,EAAE,EAAE,CAAC;EAEN,OAAO;IACNC,YAAY;IACZK,KAAK;IACLG;EACD,CAAC;AACF,CAAC;AAACV,EAAA,CArEID,aAAa;AAuEnB,eAAeA,aAAa"},"metadata":{},"sourceType":"module","externalDependencies":[]}